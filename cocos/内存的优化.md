# æ¸¸æˆå¼•æ“å†…å­˜ä¼˜åŒ–ç­–ç•¥å¤§å…¨ ğŸ§ ğŸ’¾

è®©æˆ‘è¯¦ç»†åˆ†æCocoså’ŒUnityå¼€å‘ä¸­çš„å†…å­˜ä¼˜åŒ–æŠ€æœ¯ï¼Œè¿™äº›ä¼˜åŒ–å¯¹æ¸¸æˆæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ï¼
Search files...

## ğŸ—ï¸ èµ„æºç®¡ç†ä¼˜åŒ–

### 1. **çº¹ç†å†…å­˜ä¼˜åŒ–**
> **åŸç†**ï¼šé€šè¿‡å‹ç¼©æ ¼å¼ã€Mipmapã€åˆ†è¾¨ç‡è°ƒæ•´ç­‰æ‰‹æ®µå‡å°‘çº¹ç†å ç”¨çš„æ˜¾å­˜å’Œå†…å­˜
> **åœºæ™¯**ï¼šæ‰€æœ‰é¡¹ç›®éƒ½éœ€è¦ï¼Œç‰¹åˆ«æ˜¯ç§»åŠ¨ç«¯å’Œèµ„æºä¸°å¯Œçš„3Dæ¸¸æˆ

```cpp
// Unityçº¹ç†å†…å­˜ä¼˜åŒ–ç¤ºä¾‹
class TextureMemoryOptimizer {
    void optimizeTexture(Texture2D texture) {
        // âœ… ä½¿ç”¨å‹ç¼©æ ¼å¼ï¼Œå‡å°‘4-8å€å†…å­˜
        texture.format = TextureFormat.ASTC_6x6;  // ç§»åŠ¨ç«¯
        // texture.format = TextureFormat.DXT5;   // PCç«¯
        
        // âœ… æŒ‰éœ€ç”ŸæˆMipmapï¼Œå¢åŠ 33%å†…å­˜ä½†æå‡æ€§èƒ½
        texture.mipmapCount = calculateMipmapLevels(texture);
        
        // âœ… è®¾ç½®åˆé€‚çš„æœ€å¤§åˆ†è¾¨ç‡
        texture.maxTextureSize = getOptimalSize(targetPlatform);
        
        // âŒ é¿å…ï¼šGetPixels/SetPixels ä¼šåˆ›å»ºåŒå€å†…å­˜
        // Color[] pixels = texture.GetPixels(); // å±é™©ï¼
    }
};
```

### 2. **èµ„æºé¢„åŠ è½½å’Œé‡Šæ”¾ç­–ç•¥**
> **åŸç†**ï¼šé€šè¿‡å¯¹è±¡æ± ã€å¼‚æ­¥åŠ è½½ã€åŠæ—¶é‡Šæ”¾ç­‰æ–¹å¼é¿å…å†…å­˜å³°å€¼å’Œç¢ç‰‡åŒ–
> **åœºæ™¯**ï¼šèµ„æºå¯†é›†å‹æ¸¸æˆï¼Œéœ€è¦é¢‘ç¹åŠ è½½/å¸è½½åœºæ™¯çš„é¡¹ç›®

```typescript
// Cocosèµ„æºç®¡ç†ä¼˜åŒ–
class ResourceManager {
    private resourcePool = new Map<string, any>();
    
    // âœ… å¯¹è±¡æ± å‡å°‘é¢‘ç¹åˆ†é…
    preloadCriticalAssets() {
        // é¢„åŠ è½½æ ¸å¿ƒèµ„æºåˆ°æ± ä¸­
        this.loadBatch(['ui_atlas', 'character_sprites', 'audio_sfx']);
    }
    
    // âœ… åŠæ—¶é‡Šæ”¾éå¿…è¦èµ„æº
    releaseSceneAssets(sceneName: string) {
        cc.resources.release(`scenes/${sceneName}`);
        // å¼ºåˆ¶åƒåœ¾å›æ”¶
        cc.sys.garbageCollect();
    }
}
```

### 3. **RenderTextureå†…å­˜ç®¡ç†**
> **åŸç†**ï¼šRenderTextureå ç”¨å¤§é‡GPUå†…å­˜ï¼Œå¿…é¡»æ‰‹åŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œé¿å…æ³„æ¼
> **åœºæ™¯**ï¼šä½¿ç”¨ç›¸æœºæ¸²æŸ“åˆ°çº¹ç†ã€åå¤„ç†æ•ˆæœã€UIæ¨¡ç³Šæ•ˆæœç­‰

```csharp
// Unity RenderTextureå†…å­˜é™·é˜±
public class RenderTextureManager {
    private RenderTexture currentRT;
    
    void CreateEffect() {
        // âŒ å¿˜è®°é‡Šæ”¾ä¼šå¯¼è‡´GPUå†…å­˜æ³„æ¼
        currentRT = new RenderTexture(1024, 1024, 24);
        
        // âœ… ä½¿ç”¨å®Œæ¯•ç«‹å³é‡Šæ”¾
        camera.targetTexture = currentRT;
        camera.Render();
        camera.targetTexture = null;
        
        // ğŸ”¥ å…³é”®ï¼šå¿…é¡»æ‰‹åŠ¨é‡Šæ”¾ï¼
        currentRT.Release();
        currentRT = null;
    }
}
```

## ğŸ’¾ ä»£ç å†…å­˜ä¼˜åŒ–

### 4. **å­—ç¬¦ä¸²å†…å­˜ä¼˜åŒ–**
> **åŸç†**ï¼šé¿å…é¢‘ç¹çš„å­—ç¬¦ä¸²æ‹¼æ¥å’Œè£…ç®±æ“ä½œï¼Œå‡å°‘GCå‹åŠ›
> **åœºæ™¯**ï¼šUIæ–‡æœ¬æ›´æ–°ã€æ—¥å¿—ç³»ç»Ÿã€ç½‘ç»œåè®®åºåˆ—åŒ–ç­‰

```csharp
// Unityå­—ç¬¦ä¸²ä¼˜åŒ–
public class StringOptimizer {
    private StringBuilder sb = new StringBuilder(256);
    
    // âŒ GCåƒåœ¾åˆ¶é€ æœº
    void BadStringHandling() {
        string result = "Score: " + score + " HP: " + hp; // äº§ç”Ÿå¤§é‡ä¸´æ—¶å¯¹è±¡
    }
    
    // âœ… ä½¿ç”¨StringBuilderé¿å…GC
    string OptimizedStringBuilding() {
        sb.Clear();
        sb.Append("Score: ").Append(score).Append(" HP: ").Append(hp);
        return sb.ToString();
    }
    
    // âœ… ä½¿ç”¨å¯¹è±¡æ± ç¼“å­˜å¸¸ç”¨å­—ç¬¦ä¸²
    private static readonly Dictionary<int, string> numberCache = new();
}
```

### 5. **é›†åˆå®¹å™¨ä¼˜åŒ–**
> **åŸç†**ï¼šé¢„è®¾åˆé€‚çš„å®¹å™¨å¤§å°ï¼Œé¿å…åŠ¨æ€æ‰©å®¹é€ æˆçš„å†…å­˜é‡æ–°åˆ†é…
> **åœºæ™¯**ï¼šæ¸¸æˆé€»è¾‘ä¸­å¤§é‡ä½¿ç”¨Listã€Dictionaryç­‰é›†åˆçš„åœ°æ–¹

```csharp
// å®¹å™¨å†…å­˜ä¼˜åŒ–
public class CollectionOptimizer {
    // âŒ é¢‘ç¹æ‰©å®¹å¯¼è‡´å†…å­˜ç¢ç‰‡
    List<GameObject> badList = new List<GameObject>(); // é»˜è®¤å®¹é‡4ï¼Œä¼šé¢‘ç¹æ‰©å®¹
    
    // âœ… é¢„è®¾åˆç†å®¹é‡
    List<GameObject> optimizedList = new List<GameObject>(1000); // ä¸€æ¬¡åˆ†é…è¶³å¤Ÿç©ºé—´
    
    // âœ… é‡ç”¨å®¹å™¨è€Œéé‡æ–°åˆ›å»º
    void ReusableContainer() {
        optimizedList.Clear(); // æ¸…ç©ºä½†ä¸é‡Šæ”¾å†…å­˜
        // é‡æ–°å¡«å……æ•°æ®...
    }
}
```

## ğŸ”„ è¿è¡Œæ—¶å†…å­˜ä¼˜åŒ–

### 6. **åƒåœ¾å›æ”¶ä¼˜åŒ–**
> **åŸç†**ï¼šå‡å°‘ä¸´æ—¶å¯¹è±¡åˆ†é…ï¼Œæ§åˆ¶GCè§¦å‘æ—¶æœºï¼Œé¿å…æ¸¸æˆå¡é¡¿
> **åœºæ™¯**ï¼šé«˜é¢‘æ›´æ–°çš„æ¸¸æˆé€»è¾‘ï¼Œå®æ—¶å¯¹æˆ˜æ¸¸æˆç­‰

```csharp
// GCä¼˜åŒ–ç­–ç•¥
public class GCOptimizer {
    // âœ… ç¼“å­˜é¢‘ç¹ä½¿ç”¨çš„å€¼ç±»å‹è£…ç®±
    private static readonly Dictionary<int, object> boxedInts = new();
    
    // âœ… é¿å…åœ¨Updateä¸­åˆ†é…å†…å­˜
    void Update() {
        // âŒ æ¯å¸§éƒ½åˆ›å»ºæ–°çš„Vector3
        // transform.position = new Vector3(x, y, z);
        
        // âœ… é‡ç”¨é™æ€å˜é‡
        cachedVector.Set(x, y, z);
        transform.position = cachedVector;
    }
    
    // âœ… æ‰‹åŠ¨æ§åˆ¶GCæ—¶æœº
    void OnLevelComplete() {
        // åœ¨åˆé€‚çš„æ—¶æœºè§¦å‘GC
        System.GC.Collect();
        Resources.UnloadUnusedAssets();
    }
}
```

### 7. **éŸ³é¢‘å†…å­˜ä¼˜åŒ–**
> **åŸç†**ï¼šæ ¹æ®éŸ³é¢‘ç”¨é€”é€‰æ‹©åˆé€‚çš„LoadTypeï¼Œå¹³è¡¡å†…å­˜å ç”¨å’ŒåŠ è½½æ€§èƒ½
> **åœºæ™¯**ï¼šéŸ³æ•ˆä¸°å¯Œçš„æ¸¸æˆï¼Œç‰¹åˆ«æ˜¯æœ‰å¤§é‡èƒŒæ™¯éŸ³ä¹å’ŒéŸ³æ•ˆçš„é¡¹ç›®

```csharp
// UnityéŸ³é¢‘å†…å­˜ç­–ç•¥
public enum AudioMemoryStrategy {
    // âœ… çŸ­éŸ³æ•ˆï¼šé¢„åŠ è½½åˆ°å†…å­˜
    SFX_LoadInMemory,        // å¿«é€Ÿæ’­æ”¾ï¼Œå ç”¨å†…å­˜
    
    // âœ… èƒŒæ™¯éŸ³ä¹ï¼šæµå¼æ’­æ”¾
    BGM_Streaming,           // èŠ‚çœå†…å­˜ï¼Œè½»å¾®å»¶è¿Ÿ
    
    // âœ… ä¸­ç­‰éŸ³æ•ˆï¼šå‹ç¼©åˆ°å†…å­˜
    Voice_CompressedInMemory // å¹³è¡¡æ–¹æ¡ˆ
}
```

## ğŸ“Š å†…å­˜ç›‘æ§ä¸è¯Šæ–­

### 8. **å†…å­˜æ³„æ¼æ£€æµ‹**
> **åŸç†**ï¼šé€šè¿‡å¼•ç”¨è®¡æ•°ã€å¼±å¼•ç”¨ç­‰æœºåˆ¶æ£€æµ‹å’Œé˜²æ­¢å†…å­˜æ³„æ¼
> **åœºæ™¯**ï¼šå¼€å‘é˜¶æ®µçš„å†…å­˜è°ƒè¯•ï¼Œé•¿æ—¶é—´è¿è¡Œçš„æ¸¸æˆ

```typescript
// Cocoså†…å­˜æ³„æ¼æ£€æµ‹
class MemoryProfiler {
    private static liveObjects = new Set<cc.Object>();
    
    static trackObject(obj: cc.Object) {
        this.liveObjects.add(obj);
        
        // ç›‘å¬é”€æ¯äº‹ä»¶
        obj.once('destroy', () => {
            this.liveObjects.delete(obj);
        });
    }
    
    static reportMemoryLeaks() {
        console.log(`æ½œåœ¨æ³„æ¼å¯¹è±¡æ•°é‡: ${this.liveObjects.size}`);
        this.liveObjects.forEach(obj => {
            if (obj.isValid) {
                console.warn('æœªé‡Šæ”¾å¯¹è±¡:', obj.name, obj.constructor.name);
            }
        });
    }
}
```

## ğŸ¯ å¹³å°ç‰¹å®šä¼˜åŒ–

### 9. **ç§»åŠ¨ç«¯å†…å­˜ä¼˜åŒ–**
> **åŸç†**ï¼šé’ˆå¯¹ç§»åŠ¨è®¾å¤‡å†…å­˜é™åˆ¶ï¼Œé‡‡ç”¨æ›´æ¿€è¿›çš„ä¼˜åŒ–ç­–ç•¥
> **åœºæ™¯**ï¼šç§»åŠ¨ç«¯æ¸¸æˆï¼Œç‰¹åˆ«æ˜¯ä½ç«¯è®¾å¤‡å…¼å®¹

```javascript
// ç§»åŠ¨ç«¯ç‰¹æ®Šä¼˜åŒ–
class MobileMemoryManager {
    optimizeForMobile() {
        // âœ… æ›´æ¿€è¿›çš„çº¹ç†å‹ç¼©
        cc.macro.CLEANUP_IMAGE_CACHE = true;
        
        // âœ… é™åˆ¶åŒæ—¶åŠ è½½çš„èµ„æºæ•°é‡
        cc.loader.setMaxConcurrency(3);
        
        // âœ… ç›‘å¬å†…å­˜è­¦å‘Š
        if (cc.sys.platform === cc.sys.ANDROID) {
            this.setupMemoryWarningListener();
        }
    }
    
    private setupMemoryWarningListener() {
        // æ”¶åˆ°å†…å­˜è­¦å‘Šæ—¶çš„ç´§æ€¥æ¸…ç†
        cc.game.on(cc.game.EVENT_LOW_MEMORY, () => {
            this.emergencyCleanup();
        });
    }
}
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§æŒ‡æ ‡

```javascript
// å…³é”®å†…å­˜æŒ‡æ ‡ç›‘æ§
class MemoryMetrics {
    getMemoryStats() {
        return {
            // GPUå†…å­˜
            textureMemory: cc.renderer.device._stats.textureMemory,
            bufferMemory: cc.renderer.device._stats.bufferMemory,
            
            // ç³»ç»Ÿå†…å­˜ (ä»…åœ¨æ”¯æŒçš„å¹³å°)
            totalSystemMemory: navigator.deviceMemory * 1024 * 1024 * 1024,
            usedJSHeapSize: performance.memory?.usedJSHeapSize || 0,
            
            // èµ„æºç»Ÿè®¡
            loadedTextures: cc.assetManager.assets._map.size,
            cachedAssets: cc.assetManager.assets._map.size
        };
    }
}
```

è¿™äº›å†…å­˜ä¼˜åŒ–æŠ€æœ¯å¯ä»¥æ˜¾è‘—æå‡æ¸¸æˆæ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨èµ„æºå—é™çš„ç§»åŠ¨ç«¯è®¾å¤‡ä¸Šã€‚å…³é”®æ˜¯è¦æ ¹æ®é¡¹ç›®çš„å…·ä½“éœ€æ±‚å’Œç›®æ ‡å¹³å°æ¥é€‰æ‹©åˆé€‚çš„ä¼˜åŒ–ç­–ç•¥ï¼ ğŸš€